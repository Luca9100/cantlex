<!DOCTYPE html>
<html lang="de">
<head>
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="grr.li" content="grr.li ermöglicht einen einfachen und schnellen 
    Zugriff auf die Erlassse des Kantons Graubünden über Kurztitel und Abkürzungen.">
    <title>grr.li</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center the content vertically */
            align-items: center; /* Center the content horizontally */
            height: 90vh; /* Full viewport height */
        }
        h1 {
            font-size: 64px; /* Larger font size for the title */
        }
        input {
            padding: 20px;
            width: 300px;
            margin: 10px 0;
            font-size: 18px; /* Larger font size for the input box */
        }
        .footer {
            font-size: 16px;
            color: lightgrey;
            margin-top: auto;
            padding: 20px 0;
        }
        .footer a {
            text-decoration: none; /* Remove underline */
            color: lightgrey; /* Keep the text color the same */
        }
    </style>
</head>
<body>
    <h1>grr.li</h1>
    <input 
        type="text" 
        id="abbreviation" 
        placeholder="Abkürzung oder Kurztitel eingeben" 
        onkeypress="checkEnter(event)"
        autofocus
    >
    <div class="footer">
     <a href="https://www.grr.li/about">Über grr.li</a> 
    </div>
    
    <script>
        let abbreviationMap = {}; // Will hold the abbreviation map
    
        // Load abbreviation map from JSON file
        function loadAbbreviationMap() {
            fetch('abbreviations.json') // Path to your JSON file
                .then(response => response.json())
                .then(data => {
                    // Populate abbreviationMap with the data from JSON
                    data.forEach(entry => {
                        abbreviationMap[entry.abbreviation_lower] = entry.url;
                    });
                    // Check for direct resolution on initial load
                    handleDirectResolution();
                })
                .catch(error => {
                    console.error('Error loading abbreviation map:', error);
                });
        }
    
        // Function to extract article-like patterns from the input (e.g., 6, 7, 8a, 23b)
        function extractArticles(input) {
            const regex = /\b\d+[a-z]?\b/gi;
            const matches = input.match(regex);
            return matches || [];
        }
    
        // Handle the search bar resolution
        function resolveAbbreviation() {
            const rawInput = document.getElementById('abbreviation').value.trim().toLowerCase();
    
            // Extract potential articles
            const articles = extractArticles(rawInput);
            const article = articles.length > 0 ? articles[0] : null;
    
            // Remove article part from input to get base abbreviation
            const abbreviationOnly = rawInput.replace(/\b\d+[a-z]?\b/gi, '').trim();
    
            console.log("Abbreviation only:", abbreviationOnly);
            console.log("Article extracted:", article);
    
            if (abbreviationOnly in abbreviationMap) {
                let baseUrl = abbreviationMap[abbreviationOnly];
                if (article) {
                    baseUrl += `/art/${article.toLowerCase()}`;
                }
                window.location.href = baseUrl;
            } else {
                alert('Kein Bündner Erlass mit dieser Referenz gefunden');
            }
        }
    
        // Detect "Enter" key press
        function checkEnter(event) {
            if (event.key === 'Enter') {
                resolveAbbreviation();
            }
        }
    
        // Handle direct URL resolution via path
        function handleDirectResolution() {
            const path = window.location.pathname.slice(1).toLowerCase();
            if (path in abbreviationMap) {
                window.location.href = abbreviationMap[path];
            }
        }
    
        // Array of placeholder texts
        const placeholders = [
            "Abkürzung oder Kurztitel eingeben",
            "Dar en abbreviaziun cun 'rm'",
            "Inserire abbreviazione con 'it'",
            "DVG",
            "dvg",
            "Kantonale Weinverordnung",
            "weinverordnung",
            "Nationalparkordnung",
            "nationalparkordnung",
            "StipVO",
            "stipvo",
            "VOzGesG",
            "rvzegzzpo",
            "VöV",
            "vöv",
            "NAV Alp",
            "nav alp",
            "rm LARP",
            "rm lcc",
            "rm lescha da transparenza",
            "rm LLing",
            "it CNL alpe",
            "it LCC",
            "it legge sulle pubblicazioni ufficiali",
            "it Ordinanza scolastica"
        ];
    
        function setPlaceholder() {
            const randomIndex = Math.floor(Math.random() * placeholders.length);
            const input = document.getElementById('abbreviation');
            input.placeholder = placeholders[randomIndex];
        }
    
        setInterval(setPlaceholder, 4000);
    
        window.onload = loadAbbreviationMap;
    </script>        
</body>
</html>
